<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login</title>

    <link rel="stylesheet"  type="text/css" href="css/login.css">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Font Awesome Icon -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

</head>
<body>
<div id="layout">
    <div id="login_header">
        WEBSITE QUẢN LÝ ĐÁNH GIÁ
    </div>
    <div id="login_content">
        <form method="post" onsubmit="return(displayError());">
            <div id="login">LOGIN</div>
            <div class="input-group">
                <input id="username" type="text" name="urn_login" placeholder="Username"
                       onfocus="document.getElementById('error_sign_in').style.display = 'none'; hiddenError_User();">
                <div class="input-group-append">
                    <div class="input-group-text error_login">Username is required</div>
                    <span id="user_login_warn" class="input-group-text icon_warn"><i class="fas fa-exclamation"></i></span>
                    <span id="user_login_icon" class="input-group-text icon_login"><i class="fa fa-user"></i></span>
                </div>
            </div>
            <div class="input-group">
                <input id="password" type="password" name="psw_login" placeholder="Password"
                       onfocus="document.getElementById('error_sign_in').style.display = 'none'; hiddenError_Psw();">
                <div class="input-group-append">
                    <div class="input-group-text error_login">Password is required</div>
                    <span id="psw_login_warn" class="input-group-text icon_warn"><i class="fas fa-exclamation"></i></span>
                    <span id="psw_login_icon" class="input-group-text icon_login"><i class="fa fa-unlock"></i></span>
                </div>
            </div>
            <div id="error_sign_in">
                <!--<?php
                    if(count($error) > 0) {
                        foreach($error as $error) {
                            echo "<i class='fas fa-exclamation'> " .$error. "</i>";
                        }
                    }
                ?>-->
            </div>

            <button type="button" name="button_login" id="button_login">Login</button>
        </form>
    </div>
    <div id="login_footer">
        <p>&copy; 2018 Class Servey | Design By Escanor</p>
    </div>
</div>
<!-- Bootstrap Js -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<!-- JQuery Poper -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="js/Utils.js"></script>
<script>
    function displayError() {
        var check_fail = 0;
        var username = document.getElementsByTagName("input")[0].value;
        var password = document.getElementsByTagName("input")[1].value;
        if (username === '') {
            document.getElementById("user_login_icon").style.visibility = 'hidden';
            document.getElementById("user_login_warn").style.visibility = 'visible';
            check_fail = 1;
        }
        if (password === '') {
            document.getElementById("psw_login_icon").style.visibility = 'hidden';
            document.getElementById("psw_login_warn").style.visibility = 'visible';
            check_fail = 1;
        }
        $(document).ready(function () {
            $("#user_login_warn").mouseenter(function () {
                document.getElementsByClassName("error_login")[0].style.visibility = 'visible';
            });
            $("#user_login_warn").mouseleave(function () {
                document.getElementsByClassName("error_login")[0].style.visibility = 'hidden';
            });
            $("#psw_login_warn").mouseenter(function () {
                document.getElementsByClassName("error_login")[1].style.visibility = 'visible';
            });
            $("#psw_login_warn").mouseleave(function () {
                document.getElementsByClassName("error_login")[1].style.visibility = 'hidden';
            })
        });
        return check_fail === 0;
    }
    function hiddenError_User() {
        document.getElementById("user_login_icon").style.visibility = 'visible';
        document.getElementById("user_login_warn").style.visibility = 'hidden';
    }
    function hiddenError_Psw() {
        document.getElementById("psw_login_icon").style.visibility = 'visible';
        document.getElementById("psw_login_warn").style.visibility = 'hidden';
    }
    let submitBtn = document.getElementById('button_login');
    submitBtn.onclick = function (){
        if(displayError()){
            let xmlhttp = getXmlHttpObject();
            xmlhttp.onreadystatechange = function () {
                if (this.readyState === 4) {

                    console.log(this.status);
                    console.log(this.responseText);
                    if (this.status === 200) {
                        let responseObj = JSON.parse(this.responseText);
                        if(responseObj['ok'] === true) {
                            window.localStorage.setItem('jwt', responseObj['jwt']);
                            window.location.replace(responseObj['route']);
                        } else {
                            console.log("failed login");
                            invalidLable.style.display = "block";
                            loginBtn.disabled = false;
                        }
                    }
                }

            };
            let data = new FormData();
            data.append('username', document.getElementById('username').value);
            data.append('password', document.getElementById('password').value);
            xmlhttp.open("POST", "/login", true);
            xmlhttp.send(data);
        } else {
            console.log('error');
        }
    };
</script>
</body>
</html>